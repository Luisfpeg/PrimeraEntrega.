const express = require('express');
const router = express.Router();

// Product data
let products = [
  {
    id: 1,
    title: 'Product 1',
    description: 'Description of product 1',
    code: 'P001',
    price: 10,
    status: true,
    stock: 100,
    category: 'Category 1',
    thumbnails: ['img1.jpg', 'img2.jpg']
  },
  {
    id: 2,
    title: 'Product 2',
    description: 'Description of product 2',
    code: 'P002',
    price: 20,
    status: true,
    stock: 50,
    category: 'Category 2',
    thumbnails: ['img3.jpg', 'img4.jpg']
  }
];

// List all products
router.get('/', (req, res) => {
  res.json(products);
});

// Get product by id
router.get('/:pid', (req, res) => {
  const product = products.find(p => p.id === parseInt(req.params.pid));
  if (!product) {
    res.status(404).send('Product not found');
  } else {
    res.json(product);
  }
});

// Add new product
router.post('/', (req, res) => {
  const newProduct = {
    id: products.length + 1, // Autogenerated id
    title: req.body.title,
    description: req.body.description,
    code: req.body.code,
    price: req.body.price,
    status: req.body.status,
    stock: req.body.stock,
    category: req.body.category,
    thumbnails: req.body.thumbnails
  };
  products.push(newProduct);
  res.json(newProduct);
});

// Update product by id
router.put('/:pid', (req, res) => {
  const productIndex = products.findIndex(p => p.id === parseInt(req.params.pid));
  if (productIndex === -1) {
    res.status(404).send('Product not found');
  } else {
    const updatedProduct = {
      ...products[productIndex],
      ...req.body,
      id: products[productIndex].id // Ensure the id is not changed
    };
    products[productIndex] = updatedProduct;
    res.json(updatedProduct);
  }
});

// Delete product by id
router.delete('/:pid', (req, res) => {
  const productIndex = products.findIndex(p => p.id === parseInt(req.params.pid));
  if (productIndex === -1) {
    res.status(404).send('Product not found');
  } else {
    products.splice(productIndex, 1);
    res.send('Product deleted');
  }
});

module.exports = router;